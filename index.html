<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>VibePhones RD | Tienda Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        /* Estructura de tu Carrusel (LÃ­neas 35-50 de tu GitHub) */
        .bg-carousel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -3; overflow: hidden; }
        .carousel-track { display: flex; width: 500%; height: 100%; animation: slidebg 25s infinite ease-in-out; }
        .slide { width: 20%; height: 100%; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }
        @keyframes slidebg {
            0%, 15% { transform: translateX(0); }
            20%, 35% { transform: translateX(-20%); }
            40%, 55% { transform: translateX(-40%); }
            60%, 75% { transform: translateX(-60%); }
            80%, 95% { transform: translateX(-80%); }
            100% { transform: translateX(0); }
        }
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: rgba(248, 250, 252, 0.54); }
        .product-card { background: white; border-radius: 18px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; }
        #modal-recibo { display: none; position: fixed; inset: 0; z-index: 1000; align-items: center; justify-content: center; padding: 15px; background: rgba(15, 23, 42, 0.80); }
    </style>
</head>
<body class="antialiased">

    <div class="bg-carousel">
        <div class="carousel-track">
            <div class="slide"><img src="https://images.unsplash.com/photo-1610945895017-f13b5a10bb7a?w=800"></div>
            <div class="slide"><img src="https://images.unsplash.com/photo-1593327135000-5e89331e1e97?w=800"></div>
            <div class="slide"><img src="https://images.unsplash.com/photo-1510557883182-3d4d3cbe3f17?w=800"></div>
            <div class="slide"><img src="https://images.unsplash.com/photo-1587501935894-3343723552ca?w=800"></div>
            <div class="slide"><img src="https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=800"></div>
        </div>
    </div>
    <div class="bg-overlay"></div>

    <div id="app-shell" class="max-w-[450px] mx-auto min-h-screen flex flex-col">
        <header class="bg-white/80 backdrop-blur-md p-4 sticky top-0 z-[50] border-b flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-slate-900 rounded-lg flex items-center justify-center text-white font-black text-lg">V</div>
                <h1 class="text-base font-black tracking-tighter uppercase">VibePhones RD</h1>
            </div>
            <a href="https://wa.me/18098182320" class="text-green-500 text-2xl"><i class="fa-brands fa-whatsapp"></i></a>
        </header>

        <main class="p-2">
            <div id="lista-productos" class="grid grid-cols-2 gap-3">
                </div>
        </main>

        <footer class="bg-slate-900 text-white p-6 rounded-t-[2rem] mt-auto text-center">
            <p class="text-[10px] font-bold uppercase tracking-widest opacity-60">Â© 2024 VibePhones RD</p>
        </footer>
    </div>

    <div id="modal-recibo">
        <div class="bg-white w-full max-w-[380px] rounded-[2rem] p-6 shadow-2xl">
            <h2 class="text-xs font-black uppercase text-slate-400 mb-4 border-b pb-2">Finalizar Pedido</h2>
            
            <div class="space-y-3">
                <input type="text" id="form-nombre" placeholder="Nombre completo" class="w-full p-3 border rounded-xl bg-slate-50 text-sm font-bold">
                <input type="email" id="form-email" placeholder="Tu Correo ElectrÃ³nico" class="w-full p-3 border rounded-xl bg-slate-50 text-sm font-bold">
                
                <select id="form-pago" class="w-full p-3 border rounded-xl bg-slate-50 text-sm font-bold">
                    <option value="" disabled selected>MÃ©todo de Pago</option>
                    <option value="Transferencia">Transferencia Bancaria</option>
                    <option value="Efectivo">Efectivo</option>
                </select>

                <select id="form-entrega" class="w-full p-3 border rounded-xl bg-slate-50 text-sm font-bold">
                    <option value="" disabled selected>Tipo de Entrega</option>
                    <option value="Envio">EnvÃ­o a Domicilio</option>
                    <option value="Retiro">Retiro en Persona</option>
                </select>

                <div class="bg-blue-50 p-4 rounded-xl text-center border-2 border-blue-100">
                    <p id="fac-equipo" class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Cargando...</p>
                    <p id="fac-total" class="text-xl font-black text-blue-600">RD$ 0</p>
                </div>

                <button onclick="procesarPedido()" class="w-full bg-slate-900 text-white p-4 rounded-xl font-black text-xs uppercase tracking-widest shadow-lg active:scale-95 transition-all">
                    Confirmar y Recibir Recibo
                </button>
                <button onclick="document.getElementById('modal-recibo').style.display='none'" class="w-full text-slate-400 text-[10px] font-bold uppercase">Cancelar</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase e EmailJS Config
        const firebaseConfig = { /* Tu config aquÃ­ */ };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        emailjs.init("YFdmH2dv7ubtkjzod");

        // Carga de productos (Respetando tu diseÃ±o de tarjetas)
        onSnapshot(query(collection(db, "productos"), orderBy("creado", "desc")), (snap) => {
            const grid = document.getElementById('lista-productos');
            grid.innerHTML = "";
            snap.forEach((doc) => {
                const p = doc.data();
                grid.innerHTML += `
                    <div class="product-card">
                        <img src="${p.img}" class="w-full h-[140px] object-contain p-2">
                        <div class="p-3">
                            <h2 class="font-black text-[11px] uppercase truncate">${p.nombre}</h2>
                            <p class="text-blue-600 font-black text-xs mb-2">RD$ ${p.precio.toLocaleString()}</p>
                            <button onclick="abrirForm('${p.nombre}', '${p.precio}')" class="w-full bg-slate-900 text-white text-[10px] font-black uppercase p-2 rounded-lg">Comprar</button>
                        </div>
                    </div>`;
            });
        });

        window.abrirForm = (eq, pr) => {
            document.getElementById('fac-equipo').innerText = eq;
            document.getElementById('fac-total').innerText = "RD$ " + pr;
            document.getElementById('modal-recibo').style.display = "flex";
        };

        // FUNCIÃ“N FINAL UNIFICADA (Enviando a tu WhatsApp 809-818-2320)
        window.procesarPedido = () => {
            const nom = document.getElementById('form-nombre').value;
            const cor = document.getElementById('form-email').value;
            const pag = document.getElementById('form-pago').value;
            const ent = document.getElementById('form-entrega').value;
            const equ = document.getElementById('fac-equipo').innerText;
            const tot = document.getElementById('fac-total').innerText;
            const idO = Math.floor(Math.random() * 90000) + 10000;

            if(!nom || !cor || !pag || !ent) return alert("âš ï¸ Completa todos los datos");

            // EnvÃ­o por EmailJS (Service: Avd121094, Template: template_v0ay44c)
            emailjs.send('Avd121094', 'template_v0ay44c', {
                nombre: nom, email: cor, product: equ, costo_total: tot, method: pag, delivery: ent, order_id: idO
            }).then(() => {
                alert("âœ… Â¡Recibo enviado a tu correo!");
                
                // EnvÃ­o AutomÃ¡tico a tu WhatsApp
                const msgWA = `ðŸ“¦ *NUEVA ORDEN VIBEPHONES RD*%0A%0AðŸ‘¤ *Cliente:* ${nom}%0AðŸ“± *Equipo:* ${equ}%0AðŸ’° *Total:* ${tot}%0AðŸ’³ *Pago:* ${pag}%0AðŸšš *Entrega:* ${ent}%0AðŸ†” *Orden:* #${idO}`;
                window.open(`https://wa.me/18098182320?text=${msgWA}`);
                
                document.getElementById('modal-recibo').style.display = "none";
            });
        };
    </script>
</body>
</html>
